#! /bin/bash
if [ "$EUID" -ne 0 ]; then
echo "Você não está executando o script com root ou sudo, por favor execute de novo o com: $0 $1"
exit 13
fi
echo "Parando o Servidor"
service bds stop
cd /etc/BDS-Common/worlds/
# Var
MENU="Mapa"
TITLE="Selecione um Mapa?"
BACK=""

LINESS="$(($(tput lines) - 5))"
COLLS=""
TAMANHO="$(($(tput lines) - 5)) $(($(tput cols) - 10)) 7"
# Var

# Init
echo "Listando os mapas"
for cOs in *
do
  echo
  echo "$cOs"
  cat /usr/opt/bds-maneger/server.properties | sed "s|server-name=Sirherobrine23-AutoScript|server-name=${cOs}|g" | sed "s|level-name=New_World|level-name=${cOs}|g" > "${cOs}/server.properties"
done

shopt -s nullglob
arr=(*)
for ((i=0; i<${#arr[@]}; i++)); do j=$((2*$i+2)); a[j]="${arr[$i]}"; a[j+1]=""; done
# Next line has extra spaces at right to try to center it:
MPA=$(whiptail --ok-button "OK" --cancel-button "Cancelar" --title "$TITLE" --backtitle "$BACK" --menu "$MENU" $TAMANHO "${a[@]}" 2>&1 >/dev/tty)
echo "O mapa Selecionado foi: $MPA , alterando configurações do servidor e o Mapa ..."
cat "$MPA/server.properties" > /etc/BDS-Common/server.properties
echo "Estamos iniciando o servidor novamente!!!, aguarde ..."
service bds start