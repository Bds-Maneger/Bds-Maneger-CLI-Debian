#!/bin/bash
pid=$(/bin/ps -fu $USER|grep -v 'grep'|grep "bedrock_server"|awk '{print $2}' | head -1)
if [ -z $pid ]; then
  echo "ERROR: Process ID not specified."
  echo
  echo "Usage: $(basename "$0") <PID>"
  exit 1
fi
kill -0 $pid > /dev/null 2>&1
pid_exist=$?
if [ $pid_exist != 0 ]; then
  echo "ERROR: Process ID $pid not found."
  exit 1
fi
kill -0 $pid > /dev/null 2>&1
pid_exist=$?
while [ $pid_exist == 0 ]; do
  kill -0 $pid > /dev/null 2>&1
  pid_exist=$?
  if [ $pid_exist == 0 ]; then
    cpu_mem_usage=$(top -b -n 1 -p $pid | grep -w -E "^ *$pid" | awk '{print $9 "," $pid0}' | sed "s|$pid||g" | sed 's|root||g' | sed 's|bedrock_server||g' | tr 'n' , | sed s/,$//)

    ME="$(free -m | awk 'NR==2{printf "%s/%sMB (%.2f%%)\n", $3,$2,$3*100/$2 }')"


    latestscpu="$(echo $cpu_mem_usage | awk '{print substr($0, 1, 5)}'|sed 's| ||g')"
    echo -ne "\rUtilização de CPU e memoria: CPU $latestscpu Memoria $ME  "
  fi
done
